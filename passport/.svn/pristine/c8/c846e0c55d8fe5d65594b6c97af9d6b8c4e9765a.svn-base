package cn.easywed.stargate.controller;

import java.util.Date;
import java.util.HashMap;
import java.util.Map;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import cn.easywed.stargate.common.util.JsonUtil;
import cn.easywed.stargate.dao.persistence.Role;
import cn.easywed.stargate.service.IRoleService;

@RequestMapping("/")
@Controller
public class RoleController {

	@Resource
	IRoleService roleService;

	@RequestMapping("/roleIndex")
	public ModelAndView index(HttpServletRequest request, HttpSession session) {

		ModelAndView mav = new ModelAndView("addRole");

		Map<String, Object> retMap = new HashMap<String, Object>();
		retMap.put("code", 0);
		retMap.put("msg", "ok");
		retMap.put("data", "");
		mav.addObject("retMap", retMap);

		return mav;
	}

	@RequestMapping("/addrole")
	@ResponseBody
	public String addrole(HttpServletRequest request) {

		Map<String, Object> retMap = new HashMap<String, Object>();
		retMap.put("code", 0);
		retMap.put("msg", "ok");
		String roleName = request.getParameter("roleName");
		String description = request.getParameter("description");
		Date date = new Date();
		Role role = new Role();
		role.setRoleName(roleName);
		role.setDescription(description);
		role.setCreateTime(date);
		role.setStatus(0);
		roleService.addRole(role);
		return JsonUtil.toJson(retMap);

	}

	@RequestMapping("/getRole")
	@ResponseBody
	public String getRole(HttpServletRequest request) {

		Map<String, Object> retMap = new HashMap<String, Object>();
		retMap.put("code", 1);
		retMap.put("msg", "ok");
		String roleId = request.getParameter("roleId");
		long roleid = Integer.parseInt(roleId);

		Role role = roleService.getById(roleid);
		retMap.put("role", role);
		return JsonUtil.toJson(retMap);

	}

	/**
	 * 更新角色路由页
	 * 
	 * 
	 */

	@RequestMapping("/updateRouter")
	public ModelAndView updateRouter(HttpServletRequest request, HttpSession session) {

		ModelAndView mav = new ModelAndView("updateRouter");

		Map<String, Object> retMap = new HashMap<String, Object>();
		Map<String, Object> dataMap = new HashMap<String, Object>();

		retMap.put("code", 0);
		retMap.put("msg", "ok");

		String roleId = request.getParameter("roleId");
		long roleid = Integer.parseInt(roleId);

		Role role = roleService.getById(roleid);
		dataMap.put("role", role);

		retMap.put("data", dataMap);
		mav.addObject("retMap", retMap);

		return mav;
	}

}
